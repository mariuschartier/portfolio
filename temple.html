<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>ASCII Bullet Hell - Progressive</title>
<!-- <link rel="stylesheet" href="style.css"> -->
<style>
    body {
        background: black;
        color: white;
        font-family: monospace;
        text-align: center;
    }
    canvas {
        background: #111;
        border: 2px solid white;
        display: block;
        margin: auto;
    }

    .moon {
        position: fixed;
        top: 50%;
        right: 10px;
        transform: translateY(-50%);
        z-index: 10;
    }
</style>
</head>
<body>
<!-- Background + world -->
  <div class="scene" id="scene">
        <div class="moon" aria-hidden="true">
        <pre>
            ⠀⠀⠀⠀⠀⠀⠀⣀⣤⡴⠶⠿⠛⢏⡿⠖⠂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
            ⠀⠀⠀⠀⢀⡴⣞⠯⠉⠈⠀⣠⡶⠊⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
            ⠀⠀⣠⣴⠟⠙⠈⣎⡹⠂⣴⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
            ⠀⢠⣯⡟⢚⣀⠀⠀⠀⡰⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
            ⠀⡿⡃⢋⣌⠂⠈⠆⡠⡎⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
            ⣸⢿⠎⢰⡈⠀⠈⠀⣹⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
            ⣸⣿⡄⠷⣠⠀⠀⠀⡸⡗⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
            ⢹⣾⣿⣷⣛⠀⠀⠀⣜⣷⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
            ⠸⣿⢻⣏⠸⡃⠀⠀⠈⢹⢧⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
            ⠀⢻⣿⡮⣠⣗⠒⠤⠀⠀⠹⣳⣤⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
            ⠀⠀⣼⢿⣗⣧⣦⢤⠇⢀⣤⣄⠙⣿⡦⣄⠀⠀⠀⠀⠀⠀⠀⠀⢀⣤⠄
            ⠀⠀⠈⠛⢏⣷⣶⣜⣤⣈⠂⠜⠀⢀⣀⡉⡭⠯⠖⠲⠒⢶⢖⣯⠟⠁⠀
            ⠀⠀⠀⠀⠀⠙⠻⣿⣿⣷⣷⣯⣔⡿⣃⠦⡵⣠⠠⢤⣤⠿⠋⠀⠀⠀⠀
            ⠀⠀⠀⠀⠀⠀⠀⠀⠉⠛⠓⠿⠽⣷⣿⣾⡿⠞⠛⠉⠀⠀⠀⠀⠀⠀⠀
        </pre>
    </div>
  </div>
<h2>ASCII Bullet Hell</h2>
<p>Survie : <span id="time">0.00</span> s</p>
<p>Difficulté : <span id="diff">1</span></p>
<p id="status"></p>

<canvas id="game" width="600" height="400"></canvas>
<a href="index.html">retour au portfolio</a>
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const cage = { x: 100, y: 50, w: 400, h: 300 };
let keys = {};
let bullets = [];
let alive = true;
let startTime = Date.now();

const player = {
    x: 300,
    y: 200,
    speed: 3
};

const stickman = [
    " O ",
    "/|\\",
    "/ \\"
];

document.addEventListener("keydown", e => {
    keys[e.key] = true;
    if (e.key === "r" && !alive) reset();
});
document.addEventListener("keyup", e => keys[e.key] = false);

function reset() {
    bullets = [];
    alive = true;
    startTime = Date.now();
    player.x = 300;
    player.y = 200;
    document.getElementById("status").textContent = "";
}

function getDifficulty() {
    return 1 + Math.floor((Date.now() - startTime) / 5000);
}

function spawnBullet() {
    const difficulty = getDifficulty();
    const speed = 1.5 + difficulty * 0.4;

    const side = Math.floor(Math.random() * 4);
    let x, y;

    if (side === 0) { x = cage.x; y = Math.random() * cage.h + cage.y; }
    if (side === 1) { x = cage.x + cage.w; y = Math.random() * cage.h + cage.y; }
    if (side === 2) { x = Math.random() * cage.w + cage.x; y = cage.y; }
    if (side === 3) { x = Math.random() * cage.w + cage.x; y = cage.y + cage.h; }

    const angle = Math.atan2(player.y - y, player.x - x);

    // Tirs multiples selon la difficulté
    const shots = Math.min(1 + Math.floor(difficulty / 3), 3);

    for (let i = 0; i < shots; i++) {
        const offset = (i - (shots - 1) / 2) * 0.25;
        bullets.push({
            x, y,
            vx: Math.cos(angle + offset) * speed,
            vy: Math.sin(angle + offset) * speed
        });
    }
}

function update() {
    if (!alive) return;

    if (keys["ArrowUp"]) player.y -= player.speed;
    if (keys["ArrowDown"]) player.y += player.speed;
    if (keys["ArrowLeft"]) player.x -= player.speed;
    if (keys["ArrowRight"]) player.x += player.speed;

    player.x = Math.max(cage.x + 20, Math.min(cage.x + cage.w - 20, player.x));
    player.y = Math.max(cage.y + 20, Math.min(cage.y + cage.h - 20, player.y));

    bullets.forEach(b => {
        b.x += b.vx;
        b.y += b.vy;

        if (Math.hypot(b.x - player.x, b.y - player.y) < 12) {
            alive = false;
            document.getElementById("status").textContent =
                "Mort — Appuie sur R pour recommencer";
        }
    });

    const difficulty = getDifficulty();
    document.getElementById("diff").textContent = difficulty;

    if (Math.random() < 0.015 + difficulty * 0.005) {
        spawnBullet();
    }

    document.getElementById("time").textContent =
        ((Date.now() - startTime) / 1000).toFixed(2);
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    ctx.strokeStyle = "white";
    ctx.strokeRect(cage.x, cage.y, cage.w, cage.h);

    ctx.fillStyle = "red";
    bullets.forEach(b => {
        ctx.beginPath();
        ctx.arc(b.x, b.y, 3, 0, Math.PI * 2);
        ctx.fill();
    });

    ctx.fillStyle = "white";
    stickman.forEach((line, i) => {
        ctx.fillText(line, player.x - 10, player.y - 10 + i * 12);
    });
}

function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
